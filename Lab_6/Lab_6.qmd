---
title: Исследование вредоносной активности в домене Windows
author: "p.pluvkov@yandex.ru"
format: 
  md:
    output-file: README.md
---

##Цель работы
1. Закрепить навыки исследования данных журнала Windows Active Directory
2. Изучить структуру журнала системы Windows Active Directory
3. Зекрепить практические навыки использования языка программирования R для обработки данных
4. Закрепить знания основных функций обработки данных экосистемы tidyverse языка R

## Исходные данные
1. Програмное обеспеченье MacOS
2. RStudio
3. Интерпретатор языка R 4.5.1

## План
Используя программный пакет dplyr языка программирования R провести анализ журналов и ответить на вопросы.

## Подготовка данных

0. Подключение библиотек
```{r setup, include=FALSE}
options(repos = c(CRAN = "https://cloud.r-project.org/"))
```

```{r}
library(tidyverse)
library(jsonlite)
library(rvest)
library(readr)
library(xml2)
```

1. Загрузка данных
```{r}
data_url <- "https://storage.yandexcloud.net/iamcth-data/dataset.tar.gz"
temp_archive <- tempfile(fileext = ".tar.gz")  # Временный файл для архива
extracted_dir <- tempdir()                     # Временная папка для распаковки

download.file(url = data_url, destfile = temp_archive, mode = "wb")

untar(tarfile = temp_archive, exdir = extracted_dir)

json_file_name <- "caldera_attack_evals_round1_day1_2019-10-20201108.json"
json_file_path <- file.path(extracted_dir, json_file_name)
```
```{r}
log_data <- jsonlite::stream_in(file(json_file_path))
```
2. Нормализация данных
```{r}
log_data_clean <- log_data %>% unnest(cols = c(event, winlog, host, agent), names_sep = "_")
log_data_clean <- log_data_clean %>% select(where(~n_distinct(.) > 1))
```

3. Просмотр структуры журнала

```{r}
glimpse(log_data_clean)
```

## Анализ данных
### Шаг 1. Какое количество хостов представлено в данном датасете?
```{r}
uni_hosts <- log_data_clean %>% distinct(winlog_computer_name)
uni_hosts
count(uni_hosts)
```
### Шаг 2. Подготовьте датафрейм с расшифровкой Windows Event_ID, приведите типы данных к типу их значений.
```{r}
webpage_url <- "https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor"
webpage <- read_html(webpage_url)
event_df <- html_table(webpage, fill = TRUE)[[1]]
event_df
```
### Шаг 3. Есть ли в логе события с высоким и средним уровнем значимости? Сколько их?















































